import pyodbc
import pandas as pd

# Establish a connection to the Teradata database
conn = pyodbc.connect('DRIVER={Teradata};DBCNAME=dbcname;UID=username;PWD=password')

# Load the data from the two tables into pandas DataFrames
df1 = pd.read_sql('SELECT * FROM table1', conn)
df2 = pd.read_sql('SELECT * FROM table2', conn)

# Compare the two DataFrames
are_equal = df1.equals(df2)

# If the DataFrames are not equal, find the differences
if not are_equal:
    # Concatenate the two data frames along the column axis
    df_all = pd.concat([df1, df2], axis='columns', keys=['First', 'Second'])

    # Find the rows where the data in the 'First' and 'Second' data frames differ
    df_diff = pd.DataFrame()
    for column in df1.columns:
        df_diff[column] = df_all['First', column] != df_all['Second', column]

    # Filter the rows where there is at least one difference
    df_diff = df_all[df_diff.any(axis=1)]

    # Write the differences to a CSV file
    df_diff.to_csv('differences.csv')



import pyodbc
import pandas as pd
from concurrent.futures import ThreadPoolExecutor

def compare_tables(table1, table2):
    # Load the data from the two tables into pandas DataFrames
    df1 = pd.read_sql(f'SELECT * FROM {table1}', conn)
    df2 = pd.read_sql(f'SELECT * FROM {table2}', conn)

    # Compare the two DataFrames
    are_equal = df1.equals(df2)

    # If the DataFrames are not equal, find the differences
    if not are_equal:
        # Concatenate the two data frames along the column axis
        df_all = pd.concat([df1, df2], axis='columns', keys=[table1, table2])

        # Find the rows where the data in the 'First' and 'Second' data frames differ
        df_diff = df_all.loc[df_all[table1] != df_all[table2]]

        # Write the differences to a CSV file
        df_diff.to_csv(f'differences_{table1}_{table2}.csv')

# Establish a connection to the Teradata database
conn = pyodbc.connect('DRIVER={Teradata};DBCNAME=dbcname;UID=username;PWD=password')

# List of table pairs to compare
table_pairs = [('table1', 'table2'), ('table3', 'table4'), ('table5', 'table6')]

# Create a ThreadPoolExecutor
with ThreadPoolExecutor() as executor:
    # For each pair of tables, submit a new task to the executor
    for table1, table2 in table_pairs:
        executor.submit(compare_tables, table1, table2)

# parallel comparison

import pyodbc
import pandas as pd
from multiprocessing import Pool

# Establish a connection to the Teradata database
conn = pyodbc.connect('DRIVER={Teradata};DBCNAME=dbcname;UID=username;PWD=password')

# Load the data from the two tables into pandas DataFrames
df1 = pd.read_sql('SELECT * FROM table1', conn)
df2 = pd.read_sql('SELECT * FROM table2', conn)

# Function to compare chunks of the dataframes
def compare_chunks(args):
    chunk1, chunk2 = args
    return chunk1.equals(chunk2)

# Split the dataframes into chunks
chunks1 = np.array_split(df1, 4)  # Adjust the number of chunks based on your CPU cores
chunks2 = np.array_split(df2, 4)

# Create a pool of workers
with Pool(4) as p:  # Adjust the number of workers based on your CPU cores
    results = p.map(compare_chunks, zip(chunks1, chunks2))

# If any chunk comparisons returned False, the dataframes are not equal
are_equal = all(results)

# If the DataFrames are not equal, find the differences
if not are_equal:
    # Concatenate the two data frames along the column axis
    df_all = pd.concat([df1, df2], axis='columns', keys=['First', 'Second'])

    # Find the rows where the data in the 'First' and 'Second' data frames differ
    df_diff = df_all[df_all['First'] != df_all['Second']]

    # Write the differences to a CSV file
    df_diff.to_csv('differences.csv')




.......................

# Get the column names
columns = df1.columns

# Initialize an empty DataFrame to store the differences
df_diff = pd.DataFrame()

# Compare each column in 'First' and 'Second'
for col in columns:
    diff = df_all['First', col] != df_all['Second', col]
    df_diff = pd.concat([df_diff, df_all[diff]], axis=0)

# Remove duplicate rows
df_diff = df_diff.drop_duplicates()

# Write the differences to a CSV file
df_diff.to_csv('differences.csv')

......................


if not are_equal:
    # Create a boolean DataFrame indicating differences
    df_diff = df1.ne(df2)

    # Print the contents of df_diff
    print("df_diff:")
    print(df_diff)

    # Filter the rows where there is at least one difference
    any_diff = df_diff.any(axis=1)
    df_diff_filtered = pd.concat([df1[any_diff], df2[any_diff]], axis='columns', keys=['First', 'Second'])

    # Print the contents of df_diff_filtered
    print("df_diff_filtered:")
    print(df_diff_filtered)

    # Write the differences to a CSV file
    df_diff_filtered.to_csv('differences.csv', index=False)
else:
    print("No differences found.")
    df_diff.to_csv('differences.csv', index=False)
else:
    print("No differences found.")
